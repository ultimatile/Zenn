---
title: "rsyncã§ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã«ã‚ˆã‚‹è»¢é€ãƒ•ã‚¡ã‚¤ãƒ«å·®åˆ†è¨ˆç®—æ™‚ã«ç‰¹å®šã‚µã‚¤ã‚ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã§èª¤æ¤œçŸ¥ãŒç™ºç”Ÿã™ã‚‹å•é¡Œ"
emoji: "ğŸ¦€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ğŸ›]
published: false
---

## æ¦‚è¦

rsyncã¯è»¢é€å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«å·®åˆ†ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã§å·®åˆ†ã‚’åˆ¤å®šã—ã¾ã™ãŒã€`--checksum`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ ï¼ˆãƒãƒƒã‚·ãƒ¥å€¤ï¼‰ã§åˆ¤å®šã—ã¾ã™ã€‚

ã“ã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ è¨ˆç®—ã«ãƒã‚°ãŒã‚ã‚Šã€ç‰¹å®šæ¡ä»¶ä¸‹ã§åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã«å·®åˆ†ã‚ã‚Šã¨èª¤èªè­˜ã•ã‚Œã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ãƒã‚°ã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«29ã‹ã¤ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã«ã‚ˆã‚‹å·®åˆ†è¨ˆç®—ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§å·®åˆ†è¨ˆç®—ã™ã‚‹ãŸã‚ã€å¤šãã®å ´åˆã¯å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚

macOS 15.7 (Sequoia) ã«ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹rsync (openrsync)ã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«29ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```shell-session
$ rsync -V
openrsync: protocol version 29
rsync version 2.6.9 compatible
```

## ç™ºç”Ÿæ¡ä»¶

- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ãƒªãƒ¢ãƒ¼ãƒˆé–“ã®è»¢é€ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–“ã§ã¯ç™ºç”Ÿã—ãªã„ï¼‰
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«29ã‚’ä½¿ç”¨
- `--checksum`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å·®åˆ†è¨ˆç®—
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ64ã®å€æ•°ãƒã‚¤ãƒˆ
- ãƒªãƒ¢ãƒ¼ãƒˆå´ãŒrsync 3.2.5ï¼ˆ3.1.3ã§ã¯ç™ºç”Ÿã—ãªã„ï¼‰

## å›é¿æ³•

- ãƒ—ãƒ­ãƒˆã‚³ãƒ«30ä»¥é™ã‚’ä½¿ç”¨ã™ã‚‹
- GNU rsyncã§`--checksum-choice=md4`ã¾ãŸã¯`md5`ã‚’æŒ‡å®š
  - openrsyncã§ã¯`--checksum-choice`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒãªã„ãŸã‚ä½¿ç”¨ä¸å¯
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«ã‚ˆã‚‹å·®åˆ†è¨ˆç®—ã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- ãƒªãƒ¢ãƒ¼ãƒˆã§GNU rsync 3.2ä»¥å¤–ã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆè¦æ¤œè¨¼ï¼‰

## å†ç¾æ‰‹é †

`your-remote-host`ã‚’é©åˆ‡ãªãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆåã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

```bash
# 64ãƒã‚¤ãƒˆã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
head -c 64 /dev/urandom | base64 | head -c 64 > /tmp/test64.bin

# ãƒªãƒ¢ãƒ¼ãƒˆã«åŒæœŸ
rsync -avz /tmp/test64.bin your-remote-host:~/test64.bin

# ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã§å·®åˆ†ç¢ºèªï¼ˆãƒã‚°ãŒç™ºç”Ÿã™ã‚‹ï¼‰
rsync -avz --checksum --protocol=29 --dry-run --itemize-changes \
  /tmp/test64.bin your-remote-host:~/test64.bin
```

å‡ºåŠ›ä¾‹ï¼š

```shell-session
building file list ... done
<fc......... test64.bin

sent 92 bytes  received 30 bytes  81.33 bytes/sec
total size is 64  speedup is 0.52 (DRY RUN)
```

`<fc`ã¯ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¸ä¸€è‡´ã‚’æ„å‘³ã—ã¾ã™ã€‚
å·®åˆ†ãŒãªã‘ã‚Œã°ã“ã®è¡Œã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³èª¬æ˜

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| `--checksum` | å·®åˆ†è¨ˆç®—ã«ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’ä½¿ç”¨ |
| `--protocol=29` | ãƒ—ãƒ­ãƒˆã‚³ãƒ«29ã‚’å¼·åˆ¶ |
| `--dry-run` | å®Ÿéš›ã«ã¯è»¢é€ã—ãªã„ |
| `--itemize-changes` | å¤‰æ›´å†…å®¹ã‚’è©³ç´°è¡¨ç¤º |

ãªãŠã€`--protocol=29`ã¯GNU rsyncã§openrsyncã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’åˆã‚ã›ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
openrsyncã§ã¯æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ—ãƒ­ãƒˆã‚³ãƒ«29ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

## æ¤œè¨¼ç’°å¢ƒ

| ç’°å¢ƒ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|-----|-----------|
| ãƒ­ãƒ¼ã‚«ãƒ« (macOSãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«) | openrsync protocol version 29 |
| ãƒ­ãƒ¼ã‚«ãƒ« (Homebrew) | rsync 3.4.1 protocol version 32 |
| ãƒªãƒ¢ãƒ¼ãƒˆ (ç™ºç”Ÿ) | rsync 3.2.5 protocol version 31 |
| ãƒªãƒ¢ãƒ¼ãƒˆ (ç™ºç”Ÿã›ãš) | rsync 3.1.3 protocol version 31 |
